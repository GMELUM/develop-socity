!function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function e(e,n){return function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,s,o=[],r=!0,c=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);r=!0);}catch(u){c=!0,s=u}finally{try{r||null==n.return||n.return()}finally{if(c)throw s}}return o}}(e,n)||function(e,n){if(e){if("string"===typeof e)return t(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var i=function(){function t(n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.client=void 0,this.clientURL=void 0,this.clientParams=void 0,this.socketStatus="CLOSE",this.timeoutIndexMax=5,this.timeoutIndex=0,this.timeout=void 0,this.closeTimeout=function(){clearTimeout(i.timeout),i.timeoutIndex=0,i.timeout=null},this.startTimeout=function(t,e){clearTimeout(i.timeout),i.timeout=null,i.timeout=setTimeout((function(){i.timeoutIndex=i.timeoutIndex+1,i.isError()?e():t()}),i.timeoutDelay())},this.connect=function(){i.isClose()&&i.setStatus("USER_OPEN")},this.disconnect=function(){i.isOpen()&&i.setStatus("USER_CLOSE")},this.initSocket=function(){var t=new WebSocket(i.clientURL);return t.binaryType="arraybuffer",t.onmessage=i.eventMessage,t.onopen=function(){return i.setStatus("OPEN")},t.onclose=function(t){var e=t.code;return i.setStatus(1006===e?"ABORT":"CLOSE")},t},this.destroySocket=function(){i.client.close()},this.eventUserOpen=function(){i.closeTimeout(),i.client=i.initSocket()},this.eventUserClose=function(){i.closeTimeout(),i.destroySocket()},this.eventOpen=function(){},this.eventConnect=function(){i.closeTimeout()},this.eventClose=function(){i.destroySocket(),i.startTimeout((function(){i.client=i.initSocket()}),(function(){i.closeTimeout(),i.setStatus("ERROR")}))},this.eventError=function(){},this.eventMessage=function(t){var n=e(i.decoding(t.data),3),s=n[0],o=n[1],r=n[2];"CONNECT"===i.getStatus()&&s?postMessage([s,o,r]):"OPEN"===i.getStatus()&&"connect"===s?i.setStatus("CONNECT"):"OPEN"===i.getStatus()&&"handshake"===s&&i.send(["handshake",i.clientParams,1])},this.send=function(t){var n=e(t,3),s=n[0],o=n[1],r=n[2],c=i.encoding([s,o,r]);i.client&&i.client.send(c)},this.decoding=function(t){try{var n=new TextDecoder("utf8").decode(t),i=e(JSON.parse(n),3),s=i[0],o=i[1],r=i[2];return s?[s,o,r]:[null,null,null]}catch(c){return[null,null,null]}},this.encoding=function(t){try{var e=JSON.stringify(t);return(new TextEncoder).encode(e)}catch(n){return(new TextEncoder).encode("")}},this.clientURL=n.url,this.clientParams=n.params,this.client=this.initSocket()}var i,s,o;return i=t,(s=[{key:"timeoutDelay",value:function(){return[1e3,2e3,5e3,1e4][this.timeoutIndex]||1e4}},{key:"isError",value:function(){return this.timeoutIndex>=this.timeoutIndexMax}},{key:"isConnecting",value:function(){return this.client.readyState===this.client.CONNECTING}},{key:"isOpened",value:function(){return this.client.readyState===this.client.OPEN}},{key:"isOpen",value:function(){return this.isConnecting||this.isOpened}},{key:"isClosing",value:function(){return this.client.readyState===this.client.CLOSING}},{key:"isClosed",value:function(){return this.client.readyState===this.client.CLOSED}},{key:"isClose",value:function(){return this.isClosed||this.isClosing}},{key:"getStatus",value:function(){return this.socketStatus}},{key:"setStatus",value:function(t){if(["OPEN","CONNECT","CLOSE","ERROR"].includes(t)&&"USER_CLOSE"!=this.getStatus())switch(t){case"USER_OPEN":this.eventUserOpen();break;case"USER_CLOSE":this.eventUserClose();break;case"OPEN":this.eventOpen();break;case"CONNECT":this.eventConnect();break;case"CLOSE":this.eventClose();break;case"ERROR":this.eventError()}else switch(t){case"USER_OPEN":this.eventUserOpen();break;case"USER_CLOSE":case"ABORT":this.eventUserClose()}postMessage([t,{},null]),this.socketStatus=t}}])&&n(i.prototype,s),o&&n(i,o),Object.defineProperty(i,"prototype",{writable:!1}),t}(),s=void 0;onmessage=function(t){var e=t.data[0],n=t.data[1];switch(e){case"init":s=new i(n);break;case"send":s&&s.send(n);break;case"connect":s&&s.connect();break;case"disconnect":s&&s.disconnect()}}}();